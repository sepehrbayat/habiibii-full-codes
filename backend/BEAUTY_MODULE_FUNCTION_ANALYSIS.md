# ğŸ“Š ØªØ­Ù„ÛŒÙ„ Ø¬Ø§Ù…Ø¹ ÙØ§Ù†Ú©Ø´Ù†â€ŒÙ‡Ø§ÛŒ Ù…Ø§Ú˜ÙˆÙ„ BeautyBooking

## ğŸ¯ Ø®Ù„Ø§ØµÙ‡ Ø§Ø¬Ø±Ø§ÛŒÛŒ

Ø§ÛŒÙ† Ú¯Ø²Ø§Ø±Ø´ ØªØ­Ù„ÛŒÙ„ Ú©Ø§Ù…Ù„ Ø§Ø±ØªØ¨Ø§Ø·Ø§Øª Ùˆ Ù‡Ù…Ø§Ù‡Ù†Ú¯ÛŒ Ø¨ÛŒÙ† ØªÙ…Ø§Ù… ÙØ§Ù†Ú©Ø´Ù†â€ŒÙ‡Ø§ØŒ Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§ØŒ Ú©Ù†ØªØ±Ù„Ø±Ù‡Ø§ Ùˆ Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ù…Ø§Ú˜ÙˆÙ„ BeautyBooking Ø±Ø§ Ø§Ø±Ø§Ø¦Ù‡ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯.

---

## ğŸ“ Ø³Ø§Ø®ØªØ§Ø± Ù…Ø§Ú˜ÙˆÙ„

### 1. **Entities (Ù…Ø¯Ù„â€ŒÙ‡Ø§)**
- `BeautySalon` - Ø³Ø§Ù„Ù†/Ú©Ù„ÛŒÙ†ÛŒÚ©
- `BeautyBooking` - Ø±Ø²Ø±Ùˆ
- `BeautyService` - Ø®Ø¯Ù…Øª
- `BeautyStaff` - Ú©Ø§Ø±Ù…Ù†Ø¯
- `BeautyPackage` - Ù¾Ú©ÛŒØ¬ Ú†Ù†Ø¯Ø¬Ù„Ø³Ù‡â€ŒØ§ÛŒ
- `BeautyPackageUsage` - Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù¾Ú©ÛŒØ¬
- `BeautyReview` - Ù†Ø¸Ø±Ø§Øª
- `BeautyBadge` - Ù†Ø´Ø§Ù†â€ŒÙ‡Ø§
- `BeautyTransaction` - ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ÛŒ Ù…Ø§Ù„ÛŒ
- `BeautySubscription` - Ø§Ø´ØªØ±Ø§Ú©â€ŒÙ‡Ø§
- `BeautyGiftCard` - Ú©Ø§Ø±Øª Ù‡Ø¯ÛŒÙ‡
- `BeautyLoyaltyPoint` - Ø§Ù…ØªÛŒØ§Ø² ÙˆÙØ§Ø¯Ø§Ø±ÛŒ
- `BeautyLoyaltyCampaign` - Ú©Ù…Ù¾ÛŒÙ† ÙˆÙØ§Ø¯Ø§Ø±ÛŒ
- `BeautyRetailProduct` - Ù…Ø­ØµÙˆÙ„Ø§Øª Ø®Ø±Ø¯Ù‡â€ŒÙØ±ÙˆØ´ÛŒ
- `BeautyRetailOrder` - Ø³ÙØ§Ø±Ø´Ø§Øª Ø®Ø±Ø¯Ù‡â€ŒÙØ±ÙˆØ´ÛŒ
- `BeautyServiceCategory` - Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø®Ø¯Ù…Ø§Øª
- `BeautyServiceRelation` - Ø±ÙˆØ§Ø¨Ø· Ø¨ÛŒÙ† Ø®Ø¯Ù…Ø§Øª (cross-selling)
- `BeautyCommissionSetting` - ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú©Ù…ÛŒØ³ÛŒÙˆÙ†
- `BeautyCalendarBlock` - Ø¨Ù„ÙˆÚ©â€ŒÙ‡Ø§ÛŒ ØªÙ‚ÙˆÛŒÙ…
- `BeautyMonthlyReport` - Ú¯Ø²Ø§Ø±Ø´Ø§Øª Ù…Ø§Ù‡Ø§Ù†Ù‡

### 2. **Services (Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§)**
- `BeautyBookingService` - Ù…Ù†Ø·Ù‚ Ø§ØµÙ„ÛŒ Ø±Ø²Ø±Ùˆ
- `BeautyCalendarService` - Ù…Ø¯ÛŒØ±ÛŒØª ØªÙ‚ÙˆÛŒÙ… Ùˆ Ø¯Ø³ØªØ±Ø³ÛŒâ€ŒÙ¾Ø°ÛŒØ±ÛŒ
- `BeautyCommissionService` - Ù…Ø­Ø§Ø³Ø¨Ù‡ Ú©Ù…ÛŒØ³ÛŒÙˆÙ†
- `BeautyRevenueService` - Ù…Ø¯ÛŒØ±ÛŒØª 10 Ù…Ø¯Ù„ Ø¯Ø±Ø¢Ù…Ø¯ÛŒ
- `BeautyRankingService` - Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… Ø±ØªØ¨Ù‡â€ŒØ¨Ù†Ø¯ÛŒ Ø³Ø§Ù„Ù†â€ŒÙ‡Ø§
- `BeautyBadgeService` - Ù…Ø¯ÛŒØ±ÛŒØª Ù†Ø´Ø§Ù†â€ŒÙ‡Ø§
- `BeautySalonService` - Ø¢Ù…Ø§Ø± Ùˆ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³Ø§Ù„Ù†
- `BeautyLoyaltyService` - Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ù…ØªÛŒØ§Ø² ÙˆÙØ§Ø¯Ø§Ø±ÛŒ
- `BeautyRetailService` - Ù…Ø¯ÛŒØ±ÛŒØª ÙØ±ÙˆØ´ Ø®Ø±Ø¯Ù‡â€ŒÙØ±ÙˆØ´ÛŒ
- `BeautyCrossSellingService` - Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ø§Øª ÙØ±ÙˆØ´ Ù…ØªÙ‚Ø§Ø¨Ù„

### 3. **Controllers**
- **Admin**: Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ù†Ù„ Ø§Ø¯Ù…ÛŒÙ†
- **Vendor**: Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ù†Ù„ ÙØ±ÙˆØ´Ù†Ø¯Ù‡
- **Customer (Web)**: Ø±Ø§Ø¨Ø· ÙˆØ¨ Ù…Ø´ØªØ±ÛŒ
- **Customer (API)**: API Ù…Ø´ØªØ±ÛŒ
- **Vendor (API)**: API ÙØ±ÙˆØ´Ù†Ø¯Ù‡

### 4. **Traits**
- `BeautyPushNotification` - Ø§Ø±Ø³Ø§Ù„ Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù†
- `BeautyBookingLogic` - Ù…Ù†Ø·Ù‚ Ù…Ø´ØªØ±Ú© Ø±Ø²Ø±Ùˆ
- `BeautyApiResponse` - ÙØ±Ù…Øª Ù¾Ø§Ø³Ø® API
- `OpenTelemetryInstrumentation` - Ø±Ø¯ÛŒØ§Ø¨ÛŒ Ùˆ observability

---

## ğŸ”— Ù†Ù…ÙˆØ¯Ø§Ø± ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§ (Dependency Graph)

### **BeautyBookingService** (Ø³Ø±ÙˆÛŒØ³ Ø§ØµÙ„ÛŒ)
```
BeautyBookingService
â”œâ”€â”€ BeautyCalendarService (Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒâ€ŒÙ¾Ø°ÛŒØ±ÛŒØŒ Ø¨Ù„Ø§Ú© Ú©Ø±Ø¯Ù† Ø²Ù…Ø§Ù†)
â”œâ”€â”€ BeautyCommissionService (Ù…Ø­Ø§Ø³Ø¨Ù‡ Ú©Ù…ÛŒØ³ÛŒÙˆÙ†)
â”œâ”€â”€ BeautyRevenueService (Ø«Ø¨Øª Ø¯Ø±Ø¢Ù…Ø¯)
â”œâ”€â”€ BeautyPackage (Ù…Ø¯Ù„)
â”œâ”€â”€ BeautyPackageUsage (Ù…Ø¯Ù„)
â””â”€â”€ Traits:
    â”œâ”€â”€ Payment (Ù¾Ø±Ø¯Ø§Ø®Øª)
    â”œâ”€â”€ BeautyPushNotification (Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù†)
    â””â”€â”€ OpenTelemetryInstrumentation (Ø±Ø¯ÛŒØ§Ø¨ÛŒ)
```

### **BeautyRevenueService**
```
BeautyRevenueService
â”œâ”€â”€ BeautyRankingService (Ø¨Ø§Ø·Ù„ Ú©Ø±Ø¯Ù† cache Ø±ØªØ¨Ù‡â€ŒØ¨Ù†Ø¯ÛŒ)
â””â”€â”€ BeautyTransaction (Ù…Ø¯Ù„)
```

### **BeautyRankingService**
```
BeautyRankingService
â”œâ”€â”€ BeautyCalendarService (Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒâ€ŒÙ¾Ø°ÛŒØ±ÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ù…ØªÛŒØ§Ø²)
â””â”€â”€ BeautySalon, BeautyBooking, BeautyService (Ù…Ø¯Ù„â€ŒÙ‡Ø§)
```

### **BeautyCrossSellingService**
```
BeautyCrossSellingService
â”œâ”€â”€ BeautyRevenueService (Ø«Ø¨Øª Ø¯Ø±Ø¢Ù…Ø¯ cross-selling)
â””â”€â”€ BeautyService, BeautyServiceRelation (Ù…Ø¯Ù„â€ŒÙ‡Ø§)
```

### **BeautyRetailService**
```
BeautyRetailService
â”œâ”€â”€ BeautyRevenueService (Ø«Ø¨Øª Ø¯Ø±Ø¢Ù…Ø¯ ÙØ±ÙˆØ´ Ø®Ø±Ø¯Ù‡â€ŒÙØ±ÙˆØ´ÛŒ)
â””â”€â”€ BeautyRetailProduct, BeautyRetailOrder (Ù…Ø¯Ù„â€ŒÙ‡Ø§)
```

### **BeautyLoyaltyService**
```
BeautyLoyaltyService
â”œâ”€â”€ BeautyRevenueService (Ù…Ø­Ø§Ø³Ø¨Ù‡ Ú©Ù…ÛŒØ³ÛŒÙˆÙ† Ú©Ù…Ù¾ÛŒÙ†)
â””â”€â”€ BeautyLoyaltyPoint, BeautyLoyaltyCampaign (Ù…Ø¯Ù„â€ŒÙ‡Ø§)
```

---

## ğŸ”„ Ø¬Ø±ÛŒØ§Ù† Ø§ØµÙ„ÛŒ Ø±Ø²Ø±Ùˆ (Booking Flow)

### 1. **Ø§ÛŒØ¬Ø§Ø¯ Ø±Ø²Ø±Ùˆ** (`BeautyBookingService::createBooking`)
```
1. Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø³Ø§Ù„Ù† (verified, active)
2. Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø®Ø¯Ù…Øª (active, duration)
3. Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ú©Ø§Ø±Ù…Ù†Ø¯ (optional)
4. Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒâ€ŒÙ¾Ø°ÛŒØ±ÛŒ (BeautyCalendarService::isTimeSlotAvailable)
   â””â”€â”€ Ø¨Ø±Ø±Ø³ÛŒ Ø³Ø§Ø¹Ø§Øª Ú©Ø§Ø±ÛŒ
   â””â”€â”€ Ø¨Ø±Ø±Ø³ÛŒ ØªØ¹Ø·ÛŒÙ„Ø§Øª
   â””â”€â”€ Ø¨Ø±Ø±Ø³ÛŒ Ø¨Ù„ÙˆÚ©â€ŒÙ‡Ø§ÛŒ ØªÙ‚ÙˆÛŒÙ…
   â””â”€â”€ Ø¨Ø±Ø±Ø³ÛŒ Ø±Ø²Ø±ÙˆÙ‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯ (Ø¨Ø§ lockForUpdate Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² race condition)
5. Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…Ø¨Ø§Ù„Øº:
   â”œâ”€â”€ Ù‚ÛŒÙ…Øª Ù¾Ø§ÛŒÙ‡ Ø®Ø¯Ù…Øª
   â”œâ”€â”€ Ø®Ø¯Ù…Ø§Øª Ø§Ø¶Ø§ÙÛŒ (cross-selling)
   â”œâ”€â”€ Ù‡Ø²ÛŒÙ†Ù‡ Ù…Ø´Ø§ÙˆØ±Ù‡ (consultation)
   â”œâ”€â”€ Ø§Ø¹ØªØ¨Ø§Ø± Ù…Ø´Ø§ÙˆØ±Ù‡ (consultation credit)
   â”œâ”€â”€ ØªØ®ÙÛŒÙ Ú©ÙˆÙ¾Ù†
   â”œâ”€â”€ ØªØ®ÙÛŒÙ Ù¾Ú©ÛŒØ¬
   â”œâ”€â”€ Ù‡Ø²ÛŒÙ†Ù‡ Ø³Ø±ÙˆÛŒØ³ (service fee: 1-3%)
   â”œâ”€â”€ Ù…Ø§Ù„ÛŒØ§Øª
   â””â”€â”€ Ú©Ù…ÛŒØ³ÛŒÙˆÙ† (BeautyCommissionService::calculateCommission)
6. Ø§ÛŒØ¬Ø§Ø¯ Ø±Ø²Ø±Ùˆ Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³
7. Ø¨Ù„Ø§Ú© Ú©Ø±Ø¯Ù† Ø²Ù…Ø§Ù† (BeautyCalendarService::blockTimeSlot)
8. Ø§ÛŒØ¬Ø§Ø¯ Ù…Ú©Ø§Ù„Ù…Ù‡ Ú†Øª (createBookingConversation)
9. Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¢Ù…Ø§Ø± Ø³Ø§Ù„Ù† (BeautySalonService::updateBookingStatistics)
10. Ø§Ø±Ø³Ø§Ù„ Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† (BeautyPushNotification::sendBookingNotificationToAll)
```

### 2. **Ù¾Ø±Ø¯Ø§Ø®Øª** (`BeautyBookingService::processPayment`)
```
1. Ø¨Ø±Ø±Ø³ÛŒ Ø±ÙˆØ´ Ù¾Ø±Ø¯Ø§Ø®Øª:
   â”œâ”€â”€ wallet â†’ processWalletPayment
   â”œâ”€â”€ digital_payment â†’ processDigitalPayment
   â””â”€â”€ cash_payment â†’ processCashPayment
2. Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª Ù¾Ø±Ø¯Ø§Ø®Øª
3. Ø«Ø¨Øª Ø¯Ø±Ø¢Ù…Ø¯ (BeautyRevenueService):
   â”œâ”€â”€ recordCommission
   â”œâ”€â”€ recordServiceFee
   â”œâ”€â”€ recordPackageSale (Ø§Ú¯Ø± Ø§Ø² Ù¾Ú©ÛŒØ¬ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´Ø¯Ù‡)
   â”œâ”€â”€ recordConsultationFee (Ø§Ú¯Ø± Ù…Ø´Ø§ÙˆØ±Ù‡ Ø§Ø³Øª)
   â””â”€â”€ recordCrossSellingRevenue (Ø§Ú¯Ø± Ø®Ø¯Ù…Ø§Øª Ø§Ø¶Ø§ÙÛŒ Ø¯Ø§Ø±Ø¯)
```

### 3. **ØªØ£ÛŒÛŒØ¯ Ø±Ø²Ø±Ùˆ** (`BeautyBookingService::updateBookingStatus`)
```
1. Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø±Ø²Ø±Ùˆ
2. Ø§Ú¯Ø± confirmed Ùˆ paid:
   â””â”€â”€ Ø«Ø¨Øª Ø¯Ø±Ø¢Ù…Ø¯ (Ù…Ø´Ø§Ø¨Ù‡ processPayment)
3. Ø§Ú¯Ø± completed:
   â”œâ”€â”€ trackPackageUsage (Ø±Ø¯ÛŒØ§Ø¨ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù¾Ú©ÛŒØ¬)
   â”œâ”€â”€ awardLoyaltyPoints (Ø§Ù…ØªÛŒØ§Ø² ÙˆÙØ§Ø¯Ø§Ø±ÛŒ)
   â”œâ”€â”€ unblockTimeSlot (Ø¢Ø²Ø§Ø¯ Ú©Ø±Ø¯Ù† Ø²Ù…Ø§Ù†)
   â””â”€â”€ updateSalonStatistics (Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¢Ù…Ø§Ø±)
```

### 4. **Ù„ØºÙˆ Ø±Ø²Ø±Ùˆ** (`BeautyBookingService::cancelBooking`)
```
1. Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù‡Ø²ÛŒÙ†Ù‡ Ù„ØºÙˆ (calculateCancellationFee)
2. Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø±Ø²Ø±Ùˆ
3. Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¢Ù…Ø§Ø± Ø³Ø§Ù„Ù†
4. Ø«Ø¨Øª Ø¯Ø±Ø¢Ù…Ø¯ Ù„ØºÙˆ (BeautyRevenueService::recordCancellationFee)
5. Ø¢Ø²Ø§Ø¯ Ú©Ø±Ø¯Ù† Ø²Ù…Ø§Ù† (BeautyCalendarService::unblockTimeSlotForBooking)
6. Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ø§Ø²Ú¯Ø´Øª (processRefund)
7. Ø§Ø±Ø³Ø§Ù„ Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù†
```

---

## ğŸ›¡ï¸ Ù…Ú©Ø§Ù†ÛŒØ²Ù…â€ŒÙ‡Ø§ÛŒ Ø§Ù…Ù†ÛŒØªÛŒ Ùˆ ÛŒÚ©Ù¾Ø§Ø±Ú†Ú¯ÛŒ Ø¯Ø§Ø¯Ù‡

### 1. **Database Transactions**
ØªÙ…Ø§Ù… Ø¹Ù…Ù„ÛŒØ§Øª Ù…Ø§Ù„ÛŒ Ùˆ ØªØºÛŒÛŒØ±Ø§Øª Ù…Ù‡Ù… Ø¯Ø± `DB::transaction` Ù‚Ø±Ø§Ø± Ø¯Ø§Ø±Ù†Ø¯:
- `createBooking` - Ø§ÛŒØ¬Ø§Ø¯ Ø±Ø²Ø±Ùˆ
- `processPayment` - Ù¾Ø±Ø¯Ø§Ø®Øª
- `updatePaymentStatus` - Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª Ù¾Ø±Ø¯Ø§Ø®Øª
- `updateBookingStatus` - Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø±Ø²Ø±Ùˆ
- `cancelBooking` - Ù„ØºÙˆ Ø±Ø²Ø±Ùˆ
- `markConsultationCreditApplied` - Ø§Ø¹Ù…Ø§Ù„ Ø§Ø¹ØªØ¨Ø§Ø± Ù…Ø´Ø§ÙˆØ±Ù‡
- `trackPackageUsage` - Ø±Ø¯ÛŒØ§Ø¨ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù¾Ú©ÛŒØ¬
- `awardPointsForBooking` - Ø§Ø¹Ø·Ø§ÛŒ Ø§Ù…ØªÛŒØ§Ø² ÙˆÙØ§Ø¯Ø§Ø±ÛŒ
- `createOrder` (Retail) - Ø§ÛŒØ¬Ø§Ø¯ Ø³ÙØ§Ø±Ø´ Ø®Ø±Ø¯Ù‡â€ŒÙØ±ÙˆØ´ÛŒ

### 2. **Row-Level Locking (lockForUpdate)**
Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² race conditions:
- Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒâ€ŒÙ¾Ø°ÛŒØ±ÛŒ Ø²Ù…Ø§Ù† (`isTimeSlotAvailable`)
- Ø¨Ø±Ø±Ø³ÛŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù…Ø­ØµÙˆÙ„ (`validateProductsWithLock`)
- Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø¹ØªØ¨Ø§Ø± Ù…Ø´Ø§ÙˆØ±Ù‡ (`markConsultationCreditApplied`)
- Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù¾Ú©ÛŒØ¬ (`trackPackageUsage`)
- Ø¨Ø±Ø±Ø³ÛŒ Ø§Ù…ØªÛŒØ§Ø² ÙˆÙØ§Ø¯Ø§Ø±ÛŒ (`awardPointsForBooking`)
- Ø¨Ø±Ø±Ø³ÛŒ Ø«Ø¨Øª Ø¯Ø±Ø¢Ù…Ø¯ ØªÚ©Ø±Ø§Ø±ÛŒ (`updatePaymentStatus`, `updateBookingStatus`)

### 3. **Duplicate Prevention**
- Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ ØªØ±Ø§Ú©Ù†Ø´ Ù‚Ø¨Ù„ Ø§Ø² Ø«Ø¨Øª (`lockForUpdate` + `exists()`)
- Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù¾Ú©ÛŒØ¬ Ù‚Ø¨Ù„ Ø§Ø² Ø«Ø¨Øª
- Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ Ø§Ù…ØªÛŒØ§Ø² ÙˆÙØ§Ø¯Ø§Ø±ÛŒ Ù‚Ø¨Ù„ Ø§Ø² Ø§Ø¹Ø·Ø§

---

## ğŸ“Š Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ø¯Ø±Ø¢Ù…Ø¯ÛŒ (10 Revenue Models)

### 1. **Variable Commission** (Ú©Ù…ÛŒØ³ÛŒÙˆÙ† Ù…ØªØºÛŒØ±)
- `BeautyCommissionService::calculateCommission`
- `BeautyRevenueService::recordCommission`
- Ø¨Ø± Ø§Ø³Ø§Ø³: Ø¯Ø³ØªÙ‡ Ø®Ø¯Ù…ØªØŒ Ø³Ø·Ø­ Ø³Ø§Ù„Ù†ØŒ Ù†Ø´Ø§Ù†â€ŒÙ‡Ø§

### 2. **Monthly/Annual Subscription** (Ø§Ø´ØªØ±Ø§Ú© Ù…Ø§Ù‡Ø§Ù†Ù‡/Ø³Ø§Ù„Ø§Ù†Ù‡)
- `BeautyRevenueService::recordSubscription`
- Ø¨Ø±Ø§ÛŒ: Featured Listing, Boost Ads, Banner Ads

### 3. **Advertising** (ØªØ¨Ù„ÛŒØºØ§Øª)
- `BeautyRevenueService::recordAdvertisement`
- Ø§Ù†ÙˆØ§Ø¹: Featured Listing, Boost Ads (7/30 Ø±ÙˆØ²), Homepage Banner, Banner Ads

### 4. **Service Fee** (Ù‡Ø²ÛŒÙ†Ù‡ Ø³Ø±ÙˆÛŒØ³)
- `BeautyRevenueService::recordServiceFee`
- Ø§Ø² Ù…Ø´ØªØ±ÛŒ: 1-3% Ø§Ø² Ù…Ø¨Ù„Øº Ø±Ø²Ø±Ùˆ

### 5. **Multi-Session Packages** (Ù¾Ú©ÛŒØ¬â€ŒÙ‡Ø§ÛŒ Ú†Ù†Ø¯Ø¬Ù„Ø³Ù‡â€ŒØ§ÛŒ)
- `BeautyRevenueService::recordPackageSale`
- `BeautyBookingService::trackPackageUsage`
- ØªØ®ÙÛŒÙ Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯ Ú†Ù†Ø¯Ø¬Ù„Ø³Ù‡

### 6. **Late Cancellation Fee** (Ù‡Ø²ÛŒÙ†Ù‡ Ù„ØºÙˆ Ø¯ÛŒØ±Ù‡Ù†Ú¯Ø§Ù…)
- `BeautyBookingService::calculateCancellationFee`
- `BeautyRevenueService::recordCancellationFee`
- Ø¨Ø± Ø§Ø³Ø§Ø³ Ø²Ù…Ø§Ù† Ù„ØºÙˆ: 0%, 50%, 100%

### 7. **Consultation Service** (Ø®Ø¯Ù…Øª Ù…Ø´Ø§ÙˆØ±Ù‡)
- `BeautyRevenueService::recordConsultationFee`
- `BeautyBookingService::calculateConsultationCredit`
- `BeautyBookingService::markConsultationCreditApplied`
- Ù¾ÛŒØ´/Ù¾Ø³ Ø§Ø² Ø®Ø¯Ù…Øª

### 8. **Cross-Selling/Upsell** (ÙØ±ÙˆØ´ Ù…ØªÙ‚Ø§Ø¨Ù„)
- `BeautyCrossSellingService::getSuggestedServices`
- `BeautyRevenueService::recordCrossSellingRevenue`
- Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø®Ø¯Ù…Ø§Øª Ø§Ø¶Ø§ÙÛŒ

### 9. **Retail Sales** (ÙØ±ÙˆØ´ Ø®Ø±Ø¯Ù‡â€ŒÙØ±ÙˆØ´ÛŒ)
- `BeautyRetailService::createOrder`
- `BeautyRevenueService::recordRetailSale`
- ÙØ±ÙˆØ´ Ù…Ø­ØµÙˆÙ„Ø§Øª Ø²ÛŒØ¨Ø§ÛŒÛŒ

### 10. **Gift Cards & Loyalty Campaigns** (Ú©Ø§Ø±Øª Ù‡Ø¯ÛŒÙ‡ Ùˆ Ú©Ù…Ù¾ÛŒÙ† ÙˆÙØ§Ø¯Ø§Ø±ÛŒ)
- `BeautyRevenueService::recordGiftCardSale`
- `BeautyRevenueService::recordLoyaltyCampaignRevenue`
- `BeautyLoyaltyService::awardPointsForPurchase`
- `BeautyLoyaltyService::awardPointsForBooking`

---

## ğŸ† Ø³ÛŒØ³ØªÙ… Ù†Ø´Ø§Ù†â€ŒÙ‡Ø§ (Badge System)

### **BeautyBadgeService::calculateAndAssignBadges**
```
1. Ø¨Ø±Ø±Ø³ÛŒ "Top Rated":
   â”œâ”€â”€ avg_rating >= 4.8 (Ù‚Ø§Ø¨Ù„ ØªÙ†Ø¸ÛŒÙ… Ø§Ø² config: beautybooking.badge.top_rated.min_rating)
   â”œâ”€â”€ total_bookings >= 50 (Ù‚Ø§Ø¨Ù„ ØªÙ†Ø¸ÛŒÙ… Ø§Ø² config: beautybooking.badge.top_rated.min_bookings)
   â”œâ”€â”€ cancellation_rate < 2.0% (Ù‚Ø§Ø¨Ù„ ØªÙ†Ø¸ÛŒÙ… Ø§Ø² config: beautybooking.badge.top_rated.max_cancellation_rate)
   â”œâ”€â”€ ÙØ¹Ø§Ù„ÛŒØª Ø¯Ø± 30 Ø±ÙˆØ² Ú¯Ø°Ø´ØªÙ‡ (Ù‚Ø§Ø¨Ù„ ØªÙ†Ø¸ÛŒÙ… Ø§Ø² config: beautybooking.badge.top_rated.activity_days)
   â””â”€â”€ assignBadgeIfNotExists('top_rated')

2. Ø¨Ø±Ø±Ø³ÛŒ "Featured":
   â”œâ”€â”€ active subscription exists
   â””â”€â”€ assignBadgeIfNotExists('featured')

3. Ø¨Ø±Ø±Ø³ÛŒ "Verified":
   â””â”€â”€ Manual admin approval (is_verified flag)
```

### **Cache Management**
- `getActiveBadges` - Ø¨Ø§ cache
- `clearBadgeCache` - Ø¨Ø§Ø·Ù„ Ú©Ø±Ø¯Ù† cache
- Cache TTL: 30 Ø¯Ù‚ÛŒÙ‚Ù‡

---

## ğŸ” Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… Ø±ØªØ¨Ù‡â€ŒØ¨Ù†Ø¯ÛŒ (Ranking Algorithm)

### **BeautyRankingService::calculateRankingScore**
```
Ø§Ù…ØªÛŒØ§Ø² Ú©Ù„ = Ù…Ø¬Ù…ÙˆØ¹ (Ø§Ù…ØªÛŒØ§Ø² Ã— ÙˆØ²Ù†) / 100

1. Location (25%):
   â””â”€â”€ calculateLocationScore (Haversine formula)
   â””â”€â”€ Ù†Ø²Ø¯ÛŒÚ©â€ŒØªØ± = Ø§Ù…ØªÛŒØ§Ø² Ø¨Ø§Ù„Ø§ØªØ±

2. Featured/Boost (20%):
   â””â”€â”€ calculateFeaturedScore
   â””â”€â”€ Featured Listing > Boost Ads > Banner Ads > Top Rated > Verified

3. Rating (18%):
   â””â”€â”€ calculateRatingScore (Bayesian average)
   â””â”€â”€ Ù†Ø±Ù…Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ 0-5 Ø¨Ù‡ 0-1

4. Activity (10%):
   â””â”€â”€ calculateActivityScore
   â””â”€â”€ Ø±Ø²Ø±ÙˆÙ‡Ø§ÛŒ 30 Ø±ÙˆØ² Ú¯Ø°Ø´ØªÙ‡

5. Returning Rate (10%):
   â””â”€â”€ calculateReturningRateScore
   â””â”€â”€ Ù†Ø±Ø® Ù…Ø´ØªØ±ÛŒ Ø¨Ø±Ú¯Ø´ØªÛŒ

6. Availability (5%):
   â””â”€â”€ calculateAvailabilityScore
   â””â”€â”€ ØªØ¹Ø¯Ø§Ø¯ Ø²Ù…Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ø®Ø§Ù„ÛŒ (7 Ø±ÙˆØ² Ø¢ÛŒÙ†Ø¯Ù‡)

7. Cancellation Rate (7%):
   â””â”€â”€ calculateCancellationRateScore
   â””â”€â”€ Ù†Ø±Ø® Ù„ØºÙˆ Ù¾Ø§ÛŒÛŒÙ†â€ŒØªØ± = Ø§Ù…ØªÛŒØ§Ø² Ø¨Ø§Ù„Ø§ØªØ±

8. Service Type Match (5%):
   â””â”€â”€ calculateServiceTypeScore
   â””â”€â”€ ØªØ·Ø§Ø¨Ù‚ Ø¨Ø§ ÙÛŒÙ„ØªØ±Ù‡Ø§ÛŒ Ø¬Ø³ØªØ¬Ùˆ
```

### **Cache Strategy**
- Ranking Score: TTL 30 Ø¯Ù‚ÛŒÙ‚Ù‡
- Search Results: TTL 5 Ø¯Ù‚ÛŒÙ‚Ù‡
- Invalidation: Ù‡Ù†Ú¯Ø§Ù… ØªØºÛŒÛŒØ± subscriptionØŒ badgeØŒ rating

---

## ğŸ”” Ø³ÛŒØ³ØªÙ… Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù†

### **BeautyPushNotification Trait**
```
sendBookingNotificationToAll()
â”œâ”€â”€ sendBookingNotificationAdminPanel()
â”œâ”€â”€ sendBookingNotificationSalonPanel()
â”œâ”€â”€ sendBookingNotificationSalonApp()
â””â”€â”€ sendBookingNotificationCustomer()
```

### **Events**
- `created` - Ø±Ø²Ø±Ùˆ Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯
- `confirmed` - Ø±Ø²Ø±Ùˆ ØªØ£ÛŒÛŒØ¯ Ø´Ø¯
- `cancelled` - Ø±Ø²Ø±Ùˆ Ù„ØºÙˆ Ø´Ø¯
- `completed` - Ø±Ø²Ø±Ùˆ ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯
- `payment_received` - Ù¾Ø±Ø¯Ø§Ø®Øª Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯
- `reminder` - ÛŒØ§Ø¯Ø¢ÙˆØ±ÛŒ Ø±Ø²Ø±Ùˆ

---

## ğŸ› Ù…Ø´Ú©Ù„Ø§Øª Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø´Ø¯Ù‡ Ùˆ Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡

### 1. **Ù…Ø´Ú©Ù„: Ù…ØªØ¯ `rankSalonsByLocation` ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø´Øª**
- **Ù…ÙˆÙ‚Ø¹ÛŒØª**: `BeautySalonController::search`
- **Ø§ØµÙ„Ø§Ø­**: Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² `getRankedSalons` Ø¨Ù‡ Ø¬Ø§ÛŒ `rankSalonsByLocation`
- **ÙˆØ¶Ø¹ÛŒØª**: âœ… Ø§ØµÙ„Ø§Ø­ Ø´Ø¯

### 2. **Race Conditions (Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡ Ø¯Ø± Ú¯Ø°Ø´ØªÙ‡)**
- âœ… Revenue Recording Duplication
- âœ… Consultation Credit Double Application
- âœ… Retail Stock Race Condition
- âœ… Loyalty Points Duplicate Award

### 3. **Transaction Atomicity (Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡ Ø¯Ø± Ú¯Ø°Ø´ØªÙ‡)**
- âœ… Payment Status Update
- âœ… Booking Status Update
- âœ… Revenue Recording

### 4. **Pagination Bug (Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡ Ø¯Ø± Ú¯Ø°Ø´ØªÙ‡)**
- âœ… Offset to Page Calculation

---

## âœ… Ù‡Ù…Ø§Ù‡Ù†Ú¯ÛŒ Ùˆ Consistency

### **1. Naming Conventions**
- âœ… ØªÙ…Ø§Ù… Ù…Ø¯Ù„â€ŒÙ‡Ø§: `Beauty{Entity}`
- âœ… ØªÙ…Ø§Ù… Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§: `Beauty{Feature}Service`
- âœ… ØªÙ…Ø§Ù… Ú©Ù†ØªØ±Ù„Ø±Ù‡Ø§: `Beauty{Entity}Controller`
- âœ… ØªÙ…Ø§Ù… Ø¬Ø¯ÙˆÙ„â€ŒÙ‡Ø§: `beauty_{entity}`

### **2. Error Handling**
- âœ… Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² `translate()` Ø¨Ø±Ø§ÛŒ ØªÙ…Ø§Ù… Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§
- âœ… Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² `Helpers::error_processor()` Ø¨Ø±Ø§ÛŒ validation errors
- âœ… Try-catch Ø¨Ø±Ø§ÛŒ Ø¹Ù…Ù„ÛŒØ§Øª Ø®Ø§Ø±Ø¬ÛŒ

### **3. Response Format**
- âœ… API: `['message' => translate(...), 'data' => ...]`
- âœ… Error: `['errors' => Helpers::error_processor($validator)]`
- âœ… List: Ø´Ø§Ù…Ù„ `total`, `per_page`, `current_page`

### **4. Database Patterns**
- âœ… Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² `foreignId()` Ø¨Ø±Ø§ÛŒ foreign keys
- âœ… Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² `DB::transaction` Ø¨Ø±Ø§ÛŒ atomicity
- âœ… Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² `lockForUpdate` Ø¨Ø±Ø§ÛŒ race conditions
- âœ… Indexes Ø¨Ø±Ø§ÛŒ Ø³ØªÙˆÙ†â€ŒÙ‡Ø§ÛŒ Ù¾Ø±Ú©Ø§Ø±Ø¨Ø±Ø¯

### **5. Service Patterns**
- âœ… Dependency Injection Ø¯Ø± constructor
- âœ… Type hints Ùˆ return types
- âœ… PHPDoc Ø¨Ø§ ØªÙˆØ¶ÛŒØ­Ø§Øª Ø¯ÙˆØ²Ø¨Ø§Ù†Ù‡
- âœ… Business logic Ø¯Ø± servicesØŒ Ù†Ù‡ controllers

---

## ğŸ“ˆ Performance Optimizations

### **1. Caching**
- Ranking Scores: 30 Ø¯Ù‚ÛŒÙ‚Ù‡
- Search Results: 5 Ø¯Ù‚ÛŒÙ‚Ù‡
- Active Badges: 30 Ø¯Ù‚ÛŒÙ‚Ù‡

### **2. Eager Loading**
- Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² `with()` Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² N+1 queries
- Ù…Ø«Ø§Ù„: `BeautyBooking::with(['salon', 'service', 'staff', 'user'])`

### **3. Database Indexes**
- Foreign keys
- Status columns
- Date columns
- Composite indexes Ø¨Ø±Ø§ÛŒ query patterns Ø±Ø§ÛŒØ¬

---

## ğŸ” Security & Authorization

### **1. Authentication**
- Customer APIs: `auth:api` (sanctum)
- Vendor APIs: `auth:api` (vendor guard)

### **2. Authorization**
- Ø¨Ø±Ø±Ø³ÛŒ ownership Ø¯Ø± controllers
- `authorizeBookingOwnership` Ø¯Ø± Customer API
- `authorizeBookingAccess` Ø¯Ø± Vendor API

### **3. Validation**
- ØªÙ…Ø§Ù… inputs Ø¨Ø§ `Validator::make()`
- File upload validation (type, size)
- Business rule validation (availability, stock, etc.)

---

## ğŸ“ Ù†ØªÛŒØ¬Ù‡â€ŒÚ¯ÛŒØ±ÛŒ

### **Ù†Ù‚Ø§Ø· Ù‚ÙˆØª:**
1. âœ… Ø³Ø§Ø®ØªØ§Ø± Ù…Ù†Ø¸Ù… Ùˆ modular
2. âœ… Ø¬Ø¯Ø§Ø³Ø§Ø²ÛŒ concerns (Services, Controllers, Models)
3. âœ… Ø§Ø³ØªÙØ§Ø¯Ù‡ ØµØ­ÛŒØ­ Ø§Ø² transactions Ùˆ locking
4. âœ… Ù…Ø¯ÛŒØ±ÛŒØª cache Ø¨Ø±Ø§ÛŒ performance
5. âœ… Error handling Ø¬Ø§Ù…Ø¹
6. âœ… Documentation Ú©Ø§Ù…Ù„ (Ø¯ÙˆØ²Ø¨Ø§Ù†Ù‡)

### **Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ø§Øª Ø¨Ù‡Ø¨ÙˆØ¯:**
1. ğŸ”„ Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Unit Tests Ø¨Ø±Ø§ÛŒ ØªÙ…Ø§Ù… services
2. ğŸ”„ Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Integration Tests Ø¨Ø±Ø§ÛŒ flows Ø§ØµÙ„ÛŒ
3. ğŸ”„ Monitoring Ùˆ alerting Ø¨Ø±Ø§ÛŒ errors
4. ğŸ”„ Performance profiling Ø¨Ø±Ø§ÛŒ queries Ø³Ù†Ú¯ÛŒÙ†
5. ğŸ”„ Documentation Ø¨Ø±Ø§ÛŒ API endpoints

### **ÙˆØ¶Ø¹ÛŒØª Ú©Ù„ÛŒ:**
âœ… **Ù…Ø§Ú˜ÙˆÙ„ Ø¨Ù‡ Ø®ÙˆØ¨ÛŒ Ø³Ø§Ø®ØªØ§Ø± ÛŒØ§ÙØªÙ‡ Ùˆ Ù‡Ù…Ø§Ù‡Ù†Ú¯ Ø§Ø³Øª. ØªÙ…Ø§Ù… ÙØ§Ù†Ú©Ø´Ù†â€ŒÙ‡Ø§ Ø¨Ø§ Ù‡Ù… Ø§Ø±ØªØ¨Ø§Ø· Ø¯Ø§Ø±Ù†Ø¯ Ùˆ consistency Ø®ÙˆØ¨ÛŒ Ø¯Ø± Ú©Ø¯ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯.**

---

**ØªØ§Ø±ÛŒØ® ØªØ­Ù„ÛŒÙ„**: 2025-01-28  
**Ù†Ø³Ø®Ù‡ Ù…Ø§Ú˜ÙˆÙ„**: 1.0  
**ÙˆØ¶Ø¹ÛŒØª**: âœ… Production Ready

